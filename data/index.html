<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Aqua-tan Smart Env Monitor</title>
	<link rel="stylesheet" href="./pure.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css">
</head>

<body>
	<div class="p-m pure-menu-horizontal pure-menu-scrollable pm-fix">
		<a href="#" class="pure-menu-heading"><img width='32' height='32' title='' alt='' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IB2cksfwAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAABnklEQVRYCb2XUVLEMAxDW4b7X7mgwssorp2mtDQzYMeWJcW7fLBs27bo56VzEPp4SVgyEl9/o+77+SSZiAf3xYxEdCKeOib2+6yBSCYBCJX7AVv1HbuMDEDUDdhF/SjCTKzbWJ9W34FZInCwSnhaXEOjDUBEFD4KqnbrZBuQiIu6QFYX/oqxjj8z4IJZLhOVkQw/NBcNAFYkz0hVmzURcbo3bjegopo+gJE28N3341jqzHCPseNyAw7ESCbgOOVgY70TsmbHGf8KsiEGsh4GPDqOHA7z8ZNWG3CgSCDyOjl9MJkYPWZanDHQwBMJQpUJzLa+fwQUIYl6Z33wmhcWvNfJW3x6AxDzUu6KGCLuPd+Ag5/K4zY7cYn81wamH3BlA/E10yIj4JsbOKxfxqoNZOA7G8j49sVkGxA4EytJdqb613ButIHMRC2Td4biGsk2ANXpMMA/Rj1wqzYAp0z4JtyU18HHeIZZRxuIZE/f98ecbSCKnr0o4qt72+RVAxXhTL2JOvjMwJ0Xp4Iurvzud6ASqepRf1lf/Nf8IK7CF5KQSk/UTlbbAAAAAElFTkSuQmCC'></a>
		<ul class="pure-menu-list">
			<li class="pure-menu-item"><a href="#" class="pure-menu-link">Aqua-tan Smart Env Monitor</a></li>
		</ul>
	</div>

	<div class="l-content">

		<div class="a-t pure-g">
			<div id="temp" class="pure-u-1 pure-u-md-1-3">
				<div class="at at-temp">
					<div class="at-header">
						<h2>Air Temperature</h2>
						<span class="at-val">
							<div id="temp_val">0.0</div><span>&deg;C</span>
						</span>
					</div>
				</div>
			</div>

			<div id="humi" class="pure-u-1 pure-u-md-1-3">
				<div class="at at-humid">
					<div class="at-header">
						<h2>Humidity</h2>
						<span class="at-val">
							<div id="humi_val">0</div><span>%</span>
						</span>
					</div>
				</div>
			</div>

			<div id="pres" class="pure-u-1 pure-u-md-1-3">
				<div class="at at-pressure">
					<div class="at-header">
						<h2>Pressure</h2>
						<span class="at-val">
							<div id="pres_val">0</div><span>hPa</span>
						</span>
					</div>
				</div>
			</div>

			<div id="co2" class="pure-u-1 pure-u-md-1-3">
				<div class="at at-co2">
					<div class="at-header">
						<h2>CO2</h2>
						<span class="at-val">
							<div id="co2_val">0</div><span>ppm</span>
						</span>
					</div>
				</div>
			</div>

		</div>

		<div id="settings">

			<div id="sec_sch" class="if pure-g">
				<div class="pure-u-1 pure-u-md-1-2">
					<div class="l-box">
						<h3 class="if-head">Room ID</h3>
						<p>Set the room's unique ID (> 0) </p>
						<p>
							<form id="config" class="pure-form pure-form-stacked">
								<fieldset>
									<legend>Room ID</legend>
									<div class="pure-g">
										<div class="pure-u-1 pure-u-md-1-2">
											<label for="room_id">ID</label>
											<input id="room_id" class="pure-u-20-24" type="text" placeholder="0">
										</div>
									</div>
									<legend>Measures</legend>
									<div class="pure-g">
										<div class="pure-u-1 pure-u-md-1-1">
											<input id="enable_temp" value="1" type="checkbox"> Temperature
										</div>
										<div class="pure-u-1 pure-u-md-1-1">
											<input id="enable_humi" value="1" type="checkbox"> Humidity
										</div>
										<div class="pure-u-1 pure-u-md-1-1">
											<input id="enable_pres" value="1" type="checkbox"> Pressure
										</div>
										<div class="pure-u-1 pure-u-md-1-1">
											<input id="enable_co2" value="1" type="checkbox"> CO2
										</div>
									</div>
									<button id="conf_sub" type="submit" class="pure-button pure-button-primary">Submit</button>
								</fieldset>
							</form>
						</p>
					</div>
				</div>

				<div class="pure-u-1 pure-u-md-1-2">
					<!---
					<div class="l-box">
						<h3 class="if-head">ThingSpeak Settings</h3>
						<p>Specify settings for the IoT data visualizer <a href="https://ambidata.io">Ambient</a>.</p>
						<p>
							<form id="amb" class="pure-form pure-form-stacked">
								<fieldset>
									<legend>Use Ambient</legend>
									<div class="pure-g">
										<div class="pure-u-1 pure-u-md-1-1">
											<input id="amb_enable" value="1" type="checkbox"> Enable
										</div>
									</div>
									<legend>Channel</legend>
									<div class="pure-g">
										<div class="pure-u-1 pure-u-md-1-2">
											<input id="amb_chan" class="pure-u-20-24" type="text" placeholder="0">
										</div>
									</div>
									<legend>Write key</legend>
									<div class="pure-g">
										<div class="pure-u-1 pure-u-md-1-2">
											<input id="amb_wkey" class="pure-u-20-24" type="text" placeholder="xxxx">
										</div>
									</div>
									<button id="amb_sub" type="submit" class="pure-button pure-button-primary">Submit</button>
								</fieldset>
							</form>
						</p>
					</div>
			    -->
				</div>

				<div class="pure-u-1 pure-u-md-1-2">
					<div class="l-box">
						<h3 class="if-head">Reset WiFi settings</h3>
						<p>Reset the WiFi AP setting by clicking this button.</p>
						<p>
							<form action="/wifireset" class="pure-form pure-form-stacked">
								<fieldset>
									<button type="submit" class="btn-red pure-button">Reset</button>
								</fieldset>
							</form>
						</p>
					</div>
				</div>

				<div class="pure-u-1 pure-u-md-1-2">
					<div class="l-box">
						<h3 class="if-head">Reset ALL settings</h3>
						<p>Reset the ALL setting by clicking this button.</p>
						<p>
							<form action="/reset" class="pure-form pure-form-stacked">
								<fieldset>
									<button type="submit" class="btn-red pure-button">Reset</button>
								</fieldset>
							</form>
						</p>
					</div>
				</div>
			</div> <!-- end if -->
		</div> <!-- end setting -->
	</div> <!-- end l-content -->
	<div class="footer l-box">
		<p>
			Aqua-tan Smart Env Monitor by @omzn 2018 / All rights researved
		</p>
	</div>
	<script type="text/javascript">

		$('form#config').submit(
			function (ev) {
				$.post('/config',
					//					"enable_temp=" + $('#enable_temp').prop('checked').toString() +
					"&id=" + $('#room_id').val(),
					read, "json");
				$('#conf_sub').prop('disabled', true);
				return false;
			});

		function update() {
			$.getJSON('/status', function (json) {
				$('#temp_val').html(json.temperature.toFixed(1).toString());
				$('#pres_val').html(json.pressure.toFixed(0).toString());
				$('#humi_val').html(json.humidity.toFixed(1).toString());
				$('#co2_val').html(json.co2.toString());
			});
		}

		function read(json) {
			if (json.enable_temp == "true") {
				$('#enable_temp').prop("checked", true);
				$('#temp').show();
			} else {
				$('#enable_temp').prop("checked", false);
				$('#temp').hide();
			}
			if (json.enable_humi == "true") {
				$('#enable_humi').prop("checked", true);
				$('#humi').show();
			} else {
				$('#enable_humi').prop("checked", false);
				$('#humi').hide();
			}
			if (json.enable_pres == "true") {
				$('#enable_pres').prop("checked", true);
				$('#pres').show();
			} else {
				$('#enable_pres').prop("checked", false);
				$('#pres').hide();
			}
			if (json.enable_co2 == "true") {
				$('#enable_co2').prop("checked", true);
				$('#co2').show();
			} else {
				$('#enable_co2').prop("checked", false);
				$('#co2').hide();
			}
			$('#room_id').val(json.id);
			$('#enable_temp').prop("disabled", true);
			$('#enable_humi').prop("disabled", true);
			$('#enable_pres').prop("disabled", true);
			$('#enable_co2').prop("disabled", true);
		}

		function confset() {
			$.getJSON('/config', function (json) {
				read(json);
			});
		}

		$(function () {
			$('#conf_sub').prop('disabled', true);
			$('#room_id').keyup(function () {
				if ($(this).val() != '') {
					$('#conf_sub').prop('disabled', false);
				}
			});

			confset();
			update();
			setInterval("update()", 15000);
		});

	</script>
</body>

</html>